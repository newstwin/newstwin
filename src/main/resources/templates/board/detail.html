<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${post.title}">NewsTwin</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/><link rel="stylesheet" th:href="@{/css/layout/footer.css}" />
  <link rel="stylesheet" th:href="@{/css/layout/header.css}">
  <link rel="stylesheet" th:href="@{/css/board/boardpostdetail.css}">
</head>

<body>
<!-- ÏÉÅÎã® ÎÑ§ÎπÑ -->
<div th:replace="~{layout/header :: header}"></div>

<div class="container-fluid">
  <div class="row">
    <!-- Î≥∏Î¨∏ -->
    <main class="py-4">
      <div class="content-wrap">
        <!-- Îí§Î°úÍ∞ÄÍ∏∞ -->
        <button class="btn btn-secondary btn-sm mb-3 d-inline-flex align-items-center gap-1"
                 onclick="goBack()">
        <i class="bi bi-arrow-left"></i>Î™©Î°ùÏúºÎ°ú
        </button>

        <!-- Ï†úÎ™© -->
        <h1 class="post-title" id="markdownTitle">
          <span th:text="${post.title}"></span>
        </h1>

        <!-- Î©îÌÉÄÏ†ïÎ≥¥ -->
        <div class="post-meta mb-2">
          <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">2025-10-31</span>
          </span>
          Ï°∞ÌöåÏàò <span th:text="${post.count}"></span>
        </div>

        <!-- Ïç∏ÎÑ§Ïùº -->
        <div class="post-image" th:if="${post.thumbnailUrl}">
          <img th:src="@{${post.thumbnailUrl}}" alt="thumbnail">
        </div>

        <!-- Î≥∏Î¨∏ -->
        <div class="post-body">
          <span th:text="${post.content}"></span>
        </div>

        <div class="reaction-bar d-flex justify-content-between align-items-center mt-3">

          <!--Î∞òÏùëÎ≤ÑÌäº-->
          <div class="d-flex align-items-center gap-2">
            <button id="likeBtn"
                    class="btn btn-light border-0 d-flex align-items-center gap-1"
                    th:data-post-id="${post.id}"
                    th:data-liked="${liked}">
              <span id="heartIcon" th:text="${liked} ? '‚ù§Ô∏è' : 'ü§ç'"></span>
              <span id="likeCount" th:text="${likeCount}">0</span>
              <span>Ï¢ãÏïÑÏöî</span>
            </button>

            <button id="shareBtn"
                    class="btn btn-light border-0 d-flex align-items-center gap-1">
              <i class="bi bi-share"></i>
              <span>Í≥µÏú†ÌïòÍ∏∞</span>
            </button>

            <div id="shareMenu"
                 class="card position-absolute d-none"
                 style="z-index:1000; width:160px;">
              <ul class="list-group list-group-flush">
                <li class="list-group-item share-copy">üîó URL Î≥µÏÇ¨</li>
                <li class="list-group-item share-sns">üì¢ SNS Í≥µÏú†</li>
              </ul>
            </div>
          </div>

          <!-- Ïò§Î•∏Ï™Ω: ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº -->
          <div class="d-flex align-items-center gap-2" th:if="${isAuthor}">
            <a class="btn btn-plain btn-sm btn-edit"
               th:href="@{'/board/edit/' + ${post.id}}">ÏàòÏ†ï</a>

            <a id="deleteBtn"
                    class="btn btn-plain btn-sm btn-delete"
                    th:data-post-id="${post.id}">ÏÇ≠Ï†ú</a>
          </div>
        </div>

        <!-- ÎåìÍ∏Ä -->
        <div class="comment-section mt-4">
          <h6 class="fw-semibold">ÎåìÍ∏Ä<span id="commentTotal"></span></h6>

          <!-- ÏûëÏÑ±Ìèº -->
          <div class="mb-3">
            <div class="d-flex align-items-start">
              <img th:src="${loginUser != null && loginUser.profileImage != null ? loginUser.profileImage : '/images/basic-profile.png'}"
                   class="rounded-circle me-2"
                   style="width:32px;height:32px;object-fit:cover;">
              <textarea id="commentInput" class="form-control" rows="3" placeholder="ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"></textarea>
            </div>

            <div class="d-flex justify-content-end mt-2">
              <button id="commentSubmit" class="btn btn-primary btn-sm">Îì±Î°ù</button>
            </div>
          </div>

          <!-- Î™©Î°ù -->
          <ul id="commentList" class="list-unstyled"></ul>
          <!-- Î¨¥ÌïúÏä§ÌÅ¨Î°§ sentinel -->
          <div id="commentSentinel" class="py-3 text-center text-secondary small">Îçî Î∂àÎü¨Ïò§Îäî Ï§ë‚Ä¶</div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- ÌïòÎã® -->
<div th:replace="~{layout/footer :: footer}"></div>

<!-- Script ÏÉÅÏàò -->
<script th:inline="javascript">
  const IS_LOGGED_IN = [[${isLoggedIn}]];
  const MEMBER_RECEIVE_EMAIL = [[${memberReceiveEmail}]];
  const LOGIN_PROFILE_URL = /*[[${loginUser != null ? loginUser.profileImage : null}]]*/ null;
  const DEFAULT_PROFILE_URL = '/images/basic-profile.png';
  function goBack() {
    const ref = document.referrer;
    if (!ref) {
      window.location.href = "/board";
      return;
    }
    if (ref.includes("/board/write") || ref.includes("/board/edit")) {
      window.location.href = "/board";
      return;
    }
    history.back();
  }
</script>

<!-- ÌïÑÏàò JS -->
<script src="/js/common/csrfFetch.js" defer></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
<script src="/js/layout/header.js" defer></script>
<script src="/js/comments.js" defer></script>
<script src="/js/share.js" defer></script>
<script src="/js/boarddetail.js" defer></script>
</body>
</html>